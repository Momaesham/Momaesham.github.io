# Game Library

## Занятие 4. Побочные эффекты, useEffect и сохранение данных

### Цель занятия
На этом занятии мы:

* разберём, что такое побочные эффекты
* научимся использовать хук `useEffect`
* реализуем сохранение данных в `localStorage`
* научимся загружать данные при старте приложения
* сделаем приложение устойчивым к перезагрузке страницы

После этого занятия приложение начинает **хранить данные как настоящий продукт**.

---

## Проблема: данные пропадают

Сейчас:

* пользователь добавляет игры
* меняет статусы
* фильтрует список

Но:

* при обновлении страницы всё исчезает

Причина:

* state живёт только в памяти браузера

Нужно научить приложение **сохранять данные**.

---

## Что такое побочные эффекты

Побочный эффект — это действие, которое:

* не связано напрямую с рендером интерфейса
* взаимодействует с внешним миром

Примеры:

* сохранение данных
* загрузка данных
* работа с `localStorage`
* запросы к серверу

React отделяет рендер от таких действий.

---

## Хук useEffect

`useEffect` — это инструмент для работы с побочными эффектами.

Пример:

```js
useEffect(() => {
  // побочный эффект
}, [])
```

Он позволяет:

* выполнить код после рендера
* реагировать на изменения state

---

## Когда выполняется useEffect

Варианты:

### 1. Один раз при старте

```js
useEffect(() => {
  // код выполнится один раз
}, [])
```

---

### 2. При изменении state

```js
useEffect(() => {
  // код выполнится при изменении games
}, [games])
```

---

### 3. При каждом рендере

```js
useEffect(() => {
  // код выполнится всегда
})
```

В реальных приложениях чаще всего используется второй вариант.

---

## Что такое localStorage

`localStorage` — это хранилище данных в браузере.

Особенности:

* данные сохраняются между перезагрузками
* хранит только строки
* доступен из JavaScript

---

## Сохранение данных в localStorage

Так как `localStorage` хранит строки:

* объект нужно превратить в JSON

Пример:

```js
localStorage.setItem('games', JSON.stringify(games))
```

Это действие:

* не влияет на интерфейс
* является побочным эффектом

---

## Загрузка данных из localStorage

При старте приложения:

* нужно проверить, есть ли сохранённые данные
* если есть — загрузить их в state

Пример:

```js
const savedGames = localStorage.getItem('games')
```

Если данных нет — вернётся `null`.

---

## Где должна быть логика сохранения

Важно:

* `localStorage` — это часть данных
* логика должна быть в `App`

`App`:

* управляет состоянием
* отвечает за сохранение и загрузку

---

## Типичный жизненный цикл приложения

1. Приложение запускается
2. `useEffect` загружает данные
3. Пользователь работает с приложением
4. State меняется
5. `useEffect` сохраняет данные

---

## Практика

### Шаг 1. Загрузка данных при старте

* Использовать `useEffect` с пустым массивом зависимостей
* Загрузить игры из `localStorage`
* Установить state, если данные существуют

---

### Шаг 2. Сохранение при изменении state

* Использовать `useEffect` с зависимостью `[games]`
* Сохранять обновлённый список игр

---

### Шаг 3. Обработка отсутствия данных

* Проверить `null`
* Использовать пустой массив по умолчанию

---

### Шаг 4. Проверка работы

* Добавить игры
* Обновить страницу
* Убедиться, что данные не пропали

---

## Типичные ошибки

* сохранять данные при каждом рендере без зависимостей
* забывать `JSON.stringify`
* не проверять `null`
* хранить логику в дочерних компонентах

---

## Итог занятия

После четвёртого занятия:

* понимаем, что такое побочные эффекты
* умеем использовать `useEffect`
* сохраняем данные в `localStorage`
* загружаем данные при старте приложения
* понимаем жизненный цикл React-приложения

На следующем занятии:

* валидация данных
* обработка ошибок пользователя
* улучшение UX и качества кода
